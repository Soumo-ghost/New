<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misinformation Detective</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">

    <main class="w-full max-w-6xl mx-auto bg-white rounded-2xl card-shadow overflow-hidden">
        <div class="flex flex-col lg:flex-row">
            <!-- Input Section -->
            <div class="w-full lg:w-1/2 p-6 md:p-8 border-b lg:border-b-0 lg:border-r border-gray-200">
                <div class="flex items-center space-x-3 mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600"><path d="m12 14 4-4"/><path d="M3.34 19a10 10 0 1 1 17.32 0"/><path d="m12 20 4-4"/></svg>
                    <h1 class="text-2xl font-bold text-gray-800">Misinformation Detective</h1>
                </div>
                <p class="text-gray-600 mb-6">Paste text from an article, email, or social media post below. Our AI will analyze it for potential misinformation red flags and provide educational feedback.</p>

                <div class="space-y-4">
                    <label for="text-input" class="font-medium text-gray-700">Content to Analyze</label>
                    <textarea id="text-input" rows="15" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-shadow resize-none" placeholder="Paste the content here..."></textarea>
                    <div class="flex items-center justify-between">
                         <button id="analyze-button" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all transform hover:scale-105">
                            Analyze Text
                        </button>
                        <button id="clear-button" class="text-gray-500 hover:text-gray-800 font-medium">Clear</button>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div class="w-full lg:w-1/2 p-6 md:p-8">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Analysis Report</h2>
                <div id="results-container" class="space-y-6">
                    <!-- Initial State -->
                    <div id="initial-state" class="text-center text-gray-500 py-16">
                         <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-4 text-gray-400"><path d="M10.42 12.61a2.1 2.1 0 1 1 2.97 2.97L7.95 21 4 22l.99-3.95 5.43-5.44Z"/><path d="M14 4c.5 1 2 2 4 2"/><path d="M21 10c-1 .5-2 2-2 4"/><path d="m22 17-1.5-1.5"/><path d="M13 3 4 12l-2 6 6-2 9-9"/><path d="M19.5 11.5 18 10l-4 4 1.5 1.5L19.5 11.5Z"/></svg>
                        Your analysis results will appear here.
                    </div>
                    <!-- Loading State -->
                    <div id="loading-state" class="hidden text-center py-16">
                        <div class="loader mx-auto"></div>
                        <p class="mt-4 text-gray-600">Analyzing content... Please wait.</p>
                    </div>
                    <!-- Error State -->
                    <div id="error-state" class="hidden text-center py-16 bg-red-50 p-4 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-red-500 mb-2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                        <p class="font-semibold text-red-700">An error occurred.</p>
                        <p id="error-message" class="text-red-600"></p>
                    </div>
                    <!-- Content Results -->
                    <div id="content-results" class="hidden space-y-6"></div>
                </div>
            </div>
        </div>
    </main>

<script>
    const analyzeButton = document.getElementById('analyze-button');
    const clearButton = document.getElementById('clear-button');
    const textInput = document.getElementById('text-input');
    const resultsContainer = document.getElementById('results-container');
    const initialState = document.getElementById('initial-state');
    const loadingState = document.getElementById('loading-state');
    const errorState = document.getElementById('error-state');
    const errorMessage = document.getElementById('error-message');
    const contentResults = document.getElementById('content-results');
    
    const API_KEY = ""; // In a real app, this would be handled securely. For this example, it's left empty.
    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;

    const systemPrompt = `
        You are an expert AI in misinformation detection and media literacy education. Your task is to analyze a given text and provide a structured, helpful report.

        **Analysis Criteria:**
        1.  **Credibility Score:** Assign a score: "High Credibility", "Medium Credibility", or "Low Credibility".
        2.  **Summary:** Provide a brief, neutral summary of the text's main claim.
        3.  **Red Flags:** Identify and explain potential misinformation red flags from the following list. Be specific and quote the text where possible.
            * **Emotionally Charged Language:** Use of words intended to provoke a strong emotional response (e.g., outrage, fear, excitement).
            * **Lack of Verifiable Sources:** Claims made without citing any credible evidence or sources.
            * **Vague Generalizations:** Sweeping statements that are not supported by specific facts.
            * **Pressure Tactics or Urgency:** Language that urges the reader to act immediately or share without thinking.
            * **One-Sided or Biased Viewpoint:** Presents only one side of an issue without acknowledging other perspectives.
            * **Unprofessional Tone:** Contains spelling/grammar errors, excessive capitalization, or an informal tone unsuitable for credible reporting.
        4.  **Educational Corner:** Provide 2-3 actionable tips for the user to verify this information themselves. Tips should be general media literacy advice.

        **Output Format:**
        You MUST structure your response using the following format. Do not add any extra formatting or markdown.

        [SCORE]
        Credibility Score: [Your Score Here]
        [SUMMARY]
        [Your Summary Here]
        [RED FLAGS]
        - **[Flag Name]:** [Explanation and quote]
        - **[Flag Name]:** [Explanation and quote]
        [EDUCATIONAL CORNER]
        - **[Tip Title]:** [Tip Explanation]
        - **[Tip Title]:** [Tip Explanation]
    `;

    clearButton.addEventListener('click', () => {
        textInput.value = '';
        contentResults.innerHTML = '';
        contentResults.classList.add('hidden');
        errorState.classList.add('hidden');
        loadingState.classList.add('hidden');
        initialState.classList.remove('hidden');
    });

    analyzeButton.addEventListener('click', async () => {
        const userInput = textInput.value.trim();
        if (!userInput) {
            showError("Please enter some text to analyze.");
            return;
        }

        showLoading();

        try {
            const payload = {
                contents: [{ parts: [{ text: userInput }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            const response = await fetchWithRetry(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`API request failed with status ${response.status}`);
            }

            const result = await response.json();
            
            const candidate = result.candidates?.[0];
            if (!candidate || !candidate.content?.parts?.[0]?.text) {
                throw new Error("Invalid response structure from the API.");
            }
            
            const analysisText = candidate.content.parts[0].text;
            const groundingMetadata = candidate.groundingMetadata;
            let sources = [];
            if (groundingMetadata && groundingMetadata.groundingAttributions) {
                sources = groundingMetadata.groundingAttributions
                    .map(attr => ({ uri: attr.web?.uri, title: attr.web?.title }))
                    .filter(source => source.uri && source.title);
            }

            displayResults(analysisText, sources);

        } catch (err) {
            console.error(err);
            showError("Failed to analyze the content. Please try again later.");
        }
    });

    async function fetchWithRetry(url, options, retries = 3, delay = 1000) {
        for (let i = 0; i < retries; i++) {
            try {
                return await fetch(url, options);
            } catch (error) {
                if (i === retries - 1) throw error;
                await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
            }
        }
    }
    
    function showLoading() {
        initialState.classList.add('hidden');
        errorState.classList.add('hidden');
        contentResults.classList.add('hidden');
        loadingState.classList.remove('hidden');
    }

    function showError(message) {
        errorMessage.textContent = message;
        initialState.classList.add('hidden');
        loadingState.classList.add('hidden');
        contentResults.classList.add('hidden');
        errorState.classList.remove('hidden');
    }

    function displayResults(analysis, sources) {
        contentResults.innerHTML = ''; // Clear previous results
        
        const sections = {
            score: analysis.split('[SCORE]')[1]?.split('[SUMMARY]')[0]?.trim(),
            summary: analysis.split('[SUMMARY]')[1]?.split('[RED FLAGS]')[0]?.trim(),
            redFlags: analysis.split('[RED FLAGS]')[1]?.split('[EDUCATIONAL CORNER]')[0]?.trim(),
            education: analysis.split('[EDUCATIONAL CORNER]')[1]?.trim(),
        };

        if (sections.score) {
            contentResults.appendChild(createScoreCard(sections.score));
        }
        if (sections.summary) {
            contentResults.appendChild(createSectionCard('Summary', sections.summary, 'M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10Z M12 15a3 3 0 1 0-3-3 3 3 0 0 0 3 3Z M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2Z'));
        }
        if (sections.redFlags) {
            contentResults.appendChild(createListCard('Potential Red Flags', sections.redFlags, 'M11 14h2v-2h-2v2Zm0-6h2V4h-2v4Z M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2Zm0 18a8 8 0 1 1 8-8 8 8 0 0 1-8 8Z'));
        }
        if (sections.education) {
            contentResults.appendChild(createListCard('Educational Corner', sections.education, 'M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2Zm-1 14H9v-2h2v2Zm4-4h-2v-2h2v-2h-2V8h2V6h-4v6h2v2h-2v2h4Z'));
        }
        if (sources.length > 0) {
            contentResults.appendChild(createSourcesCard(sources));
        }
        
        loadingState.classList.add('hidden');
        errorState.classList.add('hidden');
        initialState.classList.add('hidden');
        contentResults.classList.remove('hidden');
        // Animate each new card
        Array.from(contentResults.children).forEach((child, index) => {
            child.classList.add('fade-in');
            child.style.animationDelay = `${index * 100}ms`;
        });
    }

    function createScoreCard(scoreText) {
        const scoreValue = scoreText.replace('Credibility Score:', '').trim();
        let bgColor = 'bg-gray-100';
        let textColor = 'text-gray-800';
        let ringColor = 'ring-gray-300';
        let icon = '';

        if (scoreValue.toLowerCase().includes('low')) {
            bgColor = 'bg-red-100'; textColor = 'text-red-800'; ringColor = 'ring-red-300';
            icon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 mr-3"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>`;
        } else if (scoreValue.toLowerCase().includes('medium')) {
            bgColor = 'bg-yellow-100'; textColor = 'text-yellow-800'; ringColor = 'ring-yellow-300';
            icon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 mr-3"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>`;
        } else if (scoreValue.toLowerCase().includes('high')) {
            bgColor = 'bg-green-100'; textColor = 'text-green-800'; ringColor = 'ring-green-300';
            icon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 mr-3"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`;
        }

        const card = document.createElement('div');
        card.className = `p-4 rounded-lg flex items-center ring-2 ${ringColor} ${bgColor} ${textColor}`;
        card.innerHTML = `${icon}<span class="font-bold text-lg">${scoreValue}</span>`;
        return card;
    }

    function createSectionCard(title, content, svgPath) {
        const card = document.createElement('div');
        card.className = 'p-4 border border-gray-200 rounded-lg';
        card.innerHTML = `
            <h3 class="font-bold text-gray-800 text-lg mb-2 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-2 text-blue-600"><path d="${svgPath}"></path></svg>
                ${title}
            </h3>
            <p class="text-gray-700 whitespace-pre-wrap">${content}</p>
        `;
        return card;
    }

    function createListCard(title, content, svgPath) {
        const items = content.split('- **').slice(1).map(item => {
            const parts = item.split(':**');
            const title = parts[0];
            const text = parts[1] ? parts[1].trim() : '';
            return `<li class="mb-2"><strong class="font-semibold text-gray-800">${title}:</strong> <span class="text-gray-700">${text}</span></li>`;
        }).join('');

        const card = document.createElement('div');
        card.className = 'p-4 border border-gray-200 rounded-lg';
        card.innerHTML = `
            <h3 class="font-bold text-gray-800 text-lg mb-2 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-2 text-blue-600"><path d="${svgPath}"></path></svg>
                ${title}
            </h3>
            <ul class="list-none pl-1 space-y-2">${items}</ul>
        `;
        return card;
    }

     function createSourcesCard(sources) {
        const card = document.createElement('div');
        card.className = 'p-4 border border-gray-200 rounded-lg';
        const links = sources.map(source => `
            <a href="${source.uri}" target="_blank" rel="noopener noreferrer" class="block bg-gray-50 hover:bg-gray-100 p-3 rounded-lg transition-colors">
                <p class="font-semibold text-blue-700 truncate">${source.title}</p>
                <p class="text-sm text-gray-500 truncate">${source.uri}</p>
            </a>
        `).join('');
        card.innerHTML = `
            <h3 class="font-bold text-gray-800 text-lg mb-2 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-2 text-blue-600"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20z"></path><path d="M2 12h20"></path></svg>
                Fact-Check with Credible Sources
            </h3>
            <div class="space-y-2">${links}</div>
        `;
        return card;
    }
</script>

</body>
</html>